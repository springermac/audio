# Maintainer: Saul Ibarra Corretge <saghul@gmail.com>

_realname=pyqtchart
pkgbase=mingw-w64-${_realname}
pkgname="${MINGW_PACKAGE_PREFIX}-python3-${_realname}"
pkgver=5.14.0
pkgrel=0
pkgdesc="Qt5 bindings for Python (mingw-w64)"
arch=('any')
license=('GPL')
url="http://www.riverbankcomputing.co.uk/software/pyqtchart"
makedepends=("${MINGW_PACKAGE_PREFIX}-python3-sip"
             "${MINGW_PACKAGE_PREFIX}-python3-pyqt5"
             "${MINGW_PACKAGE_PREFIX}-make")
options=('strip' 'staticlibs')
source=(https://files.pythonhosted.org/packages/c8/6e/08e68bb5c3c64fbb56f1755c0b4748bb82775fa1b7c9fbaa61572eeaa76a/PyQtChart-5.14.0.tar.gz
        001-mingw-python.patch)
sha256sums=('f9004861441becab7a4a48e834da14c3976e4c03e5513c93e005d5df36085046'
            'e8bb8826d157cdd9560d11442f885b28d5b784ad13a223c1cd80d8001a47c93c')

prepare() {
 cd "${srcdir}"/PyQtChart-${pkgver}

  #Apply patches
  patch -p1 -i "${srcdir}"/001-mingw-python.patch
}

build() {
  for builddir in python3-${MINGW_CHOST}; do
    [[ -d $builddir ]] && rm -rf ${builddir}
    cp -r PyQtChart-${pkgver} ${builddir}
    pushd ${builddir} > /dev/null
    ${MINGW_PREFIX}/bin/${builddir%-${MINGW_CHOST}} configure.py \
      --no-qsci-api \
      --verbose
    make V=1
    popd > /dev/null
  done
}

package_python3-pyqtchart(){
  pkgdesc="A set of Python 3.x bindings for the Qt5 toolkit"
  depends=("${MINGW_PACKAGE_PREFIX}-python3-sip" "${MINGW_PACKAGE_PREFIX}-python3-pyqt5" "${MINGW_PACKAGE_PREFIX}-python3")

  cd python3-${MINGW_CHOST}
  # INSTALL_ROOT is needed for the QtDesigner module, the other Makefiles use DESTDIR
  make -j1 DESTDIR="${pkgdir}" INSTALL_ROOT="${pkgdir}" install
}

# Wrappers
package_mingw-w64-i686-python3-pyqtchart() {
  package_python3-pyqtchart
}

package_mingw-w64-x86_64-python3-pyqtchart() {
  package_python3-pyqtchart
}